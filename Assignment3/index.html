<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Major Studio Assignment #3</title>
		<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:100|PT+Serif|Playfair+Display|Raleway" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:100|Playfair+Display" rel="stylesheet">
		<style type="text/css">

		body {
			background-color: #000;
			color: #fff;
			font-family: 'PT Serif', serif;
			}

			h2, h3 {
			text-align: center;
			color: #ddd;
		}

			text {
				fill: black;
			}

			.container{
				max-width: 1000px;
				margin-left: auto;
				margin-right: auto;
				padding: 50px;
			}

			/* Hide amCharts watermark */
			#mapdiv a, #barChartDiv a, #lineGraphDiv a{
				display:none!important;
			}

			#mapdiv {
				width		: 100%;
				height		: 500px;
				font-size	: 11px;
				display: inline-block;
			}

			#barChartDiv {
				width		: 100%;
				height		: 500px;
				font-size	: 11px;
				font-family: 'IBM Plex Sans', sans-serif;
				display: inline-block;
			}
			#barChartDiv text, #lineGraphDiv text {
				font-family: 'IBM Plex Sans', sans-serif;
				fill:#fff;
			}

			#lineGraphDiv {
				width		: 100%;
				height		: 500px;
				font-size	: 11px;
				font-family: 'IBM Plex Sans', sans-serif;

			}

			.sources {
			  padding: 0 10px;
			  width: 100%;
			  max-width: 65rem;
			  margin: 2rem auto;
			  margin-top: 3rem;
			  opacity: 0.75;
			  font-size: 75%;
		}


		</style>
		<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
		<script src="https://www.amcharts.com/lib/3/pie.js"></script>
		<script src="https://www.amcharts.com/lib/3/ammap_amcharts_extension.js"></script>
		<script src="https://www.amcharts.com/lib/3/maps/js/continentsHigh.js"></script>
		<script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
		<link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
		<script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
		<script src="https://www.amcharts.com/lib/3/serial.js"></script>
		<script src="https://www.amcharts.com/lib/3/plugins/dataloader/dataloader.min.js"></script>
		<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
		<script src="https://www.amcharts.com/lib/3/serial.js"></script>
		<script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
		<link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
		<script src="https://www.amcharts.com/lib/3/themes/black.js"></script>
	</head>
	<body>
		<div class="container">
			<h2>Would dependable energy in health care facilities reduce maternal death rates in Sub-Saharan Africa?</h2>
		</div>

		<div class="container">
			<h2>Worldwide</h2>
			<h3>In Sub-Saharan Africa, 1 in 36 women will die from Maternal Conditions</h3>
			<div id="barChartDiv"></div>
		</div>

		<div class="container">
			<h2>Regional</h2>
			<div id="mapdiv"></div>
		</div>

		<div class="container">
			<h2>Correlation View</h2>
			<h3></h3>
			<div id="lineGraphDiv"></div>
		</div>

		<div class="container">
			<h2>Takeaway Message</h2>
		</div>

		<div class="container">
			<h2>Sources</h2>

				<p>ADAIR-ROHANI, H., ZUKOR, K., BONJOUR, S., WILBURN, S., KUESEL, A. C., HEBERT, R. AND FLETCHER, E. R.
				Limited electricity access in health facilities of sub-Saharan Africa: a systematic review of data on electricity access, sources, and reliability
				<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4168575/">Available Here</a> </p>
				<p>Thelancet.com. <a href="https://www.thelancet.com/action/showFullTableHTML?isHtml=true&tableId=tbl1&pii=S2214-109X%2817%2930488-6">Available Here</a></p>

		</div>

		<br>
		<br>






		<script type="text/javascript">

			// Create the map - load the data from external resource
			AmCharts.loadFile("https://gavamedia.com/TEMP/assignment_3_data.json", {}, function(response) {

				// Convert the data string to an object
				let data = JSON.parse(response);


				// Create the map
				var map = AmCharts.makeChart("mapdiv", {
					"type": "map",
					"theme": "light",
					"projection": "winkel3",

					// Load the data object
					"dataProvider" : data,

					// Add legend
					/*
						"#f47b20" - No Electricity (%)
						"#fff1ca" - Generator Only (%)
						"#ffe180" - Central, Solar or Other Supply (%)
						"#e8e3db" - no data?
						https://www.amcharts.com/demos/logarithmic-scale/
					*/

					"legend": {
						"width": "100%",
						"marginRight": 27,
						"marginLeft": 27,
						"equalWidths": false,
						"backgroundAlpha": 0.5,
						"backgroundColor": "#FFFFFF",
						"borderColor": "#ffffff",
						"borderAlpha": 1,
						"top": 450,
						"left": 0,
						"horizontalGap": 10,
						"data": [ {
							"title": "No Electricity (%)",
							"color": "#f47b20"
						}, {
							"title": "Generator Only (%)",
							"color": "#fff1ca"
						}, {
							"title": "Central, Solar or Other Supply (%)",
							"color": "#ffe180"
						}, {
							"title": "No Data",
							"color": "#e8e3db"
						} ]
					},

					// Event executed when map is zoomed/moved/loaded
					"listeners": [{
						"event": "positionChanged",
						"method": updateCustomMarkers
					}]
				});

			});

			// Create the bar graph chart - load the data from external resource
			AmCharts.loadFile("https://gavamedia.com/TEMP/barChart.csv", {}, function(response) {

				// Parse CSV
				var data = AmCharts.parseCSV( response, { "useColumnNames": true } );

				var chart = AmCharts.makeChart( "barChartDiv", {
					"type": "serial",
					"theme": "black",
					// // "titles": [{
					// // 	"text": "In Sub-Saharan Africa, 1 in 36 women will die from Maternal Conditions",
					// // 	"size": 15
					// }],
					"dataProvider": data,
					"valueAxes": [ {
						"gridColor": "#FFFFFF",
						"gridAlpha": 0.2,
						"dashLength": 0
					} ],
					"gridAboveGraphs": true,
					"startDuration": 1,
					"graphs": [ {
						"balloonText": "[[category]]: <b>[[value]]</b>",
						"fillAlphas": 0.8,
						"lineAlpha": 0.2,
						"type": "column",
						"valueField": "Number of Maternal Deaths (2015)"
					} ],
					"chartCursor": {
						"categoryBalloonEnabled": false,
						"cursorAlpha": 0,
						"zoomable": false
					},
					"categoryField": "Region",
					"categoryAxis": {
						"gridPosition": "start",
						"gridAlpha": 0,
						"tickPosition": "start",
						"tickLength": 20
					}
				} );
			});


			// Create the line graph chart - load the data from external resource
			AmCharts.loadFile("https://gavamedia.com/TEMP/lineChart.csv", {}, function(response) {

				// Parse CSV
				var data = AmCharts.parseCSV( response, { "useColumnNames": true } );

				var lineGraphChart = AmCharts.makeChart( "lineGraphDiv", {
					"type": "serial",
					"addClassNames": true,
					"theme": "black",
					"titles": [{
						"text": "The correlation between the lack of electricity in healthcare facilities and maternal deaths",
						"size": 15
					}],
					"autoMargins": false,
					"marginLeft": 30,
					"marginRight": 8,
					"marginTop": 10,
					"marginBottom": 26,
					"balloon": {
						"adjustBorderColor": false,
						"horizontalPadding": 10,
						"verticalPadding": 8,
						"color": "#ffffff"
					},
					"dataProvider": data,
					"valueAxes": [ {
						"axisAlpha": 0,
						"position": "left"
					} ],
					"startDuration": 1,
					"graphs": [ {
						"balloonText": "<span style='font-size:12px;'>[[title]] in [[category]]:<br><span style='font-size:20px;'>[[value]]%</span> [[additional]]</span>",
						"bullet": "round",
						"lineThickness": 3,
						"fillAlphas": 0,
						"lineAlpha": 1,
						"title": "% of Maternal Deaths per Women in Childbearing Years",
						"valueField": "% of Maternal Deaths per Women in Childbearing Years"
					}, {
						"id": "graph2",
						"balloonText": "<span style='font-size:12px;'>[[title]] in [[category]]:<br><span style='font-size:20px;'>[[value]]%</span> [[additional]]</span>",
						"bullet": "round",
						"lineThickness": 3,
						"fillAlphas": 0,
						"lineAlpha": 1,
						"title": "% of Health Facilities With No Electricity",
						"valueField": "% of All Health Facilities With No Electricity"
					} ],
					"categoryField": "Country",
					"categoryAxis": {
						"gridPosition": "start",
						"axisAlpha": 0,
						"tickLength": 0
					},
					"export": {
						"enabled": true
					}
				} );

			});



			/**
			* Creates and positions custom markers (pie charts)
			*/
			function updateCustomMarkers(event) {
				// get map object
				var map = event.chart;

				// go through all of the images
				for (var x = 0; x < map.dataProvider.images.length; x++) {

					// get MapImage object
					var image = map.dataProvider.images[x];

					// Is it a Pie?
					if (image.pie === undefined) continue;

					// create id
					if (image.id === undefined) image.id = "amcharts_pie_" + x;

					// Add theme
					if ("undefined" == typeof image.pie.theme) image.pie.theme = map.theme;



					// Click & hover events for each pie chart
					image.pie.listeners = [{
						"event": "clickSlice",
						"method": clickedPie
					}, {
						"event": "rollOverSlice",
						"method": clickedPie
					}];


					// check if it has corresponding HTML element
					if ("undefined" == typeof image.externalElement) image.externalElement = createCustomMarker(image);

					// reposition the element accoridng to coordinates
					var xy = map.coordinatesToStageXY(image.longitude, image.latitude);
					image.externalElement.style.top = xy.y + "px";
					image.externalElement.style.left = xy.x + "px";
					image.externalElement.style.marginTop = Math.round(image.height / -2) + "px";
					image.externalElement.style.marginLeft = Math.round(image.width / -2) + "px";
				}
			}


			/**
			* Creates a custom map marker - a div for container and a
			* pie chart in it
			*/
			function createCustomMarker(image) {
				// Create chart container
				var holder = document.createElement("div");
				holder.id = image.id;
				holder.title = image.title;
				holder.style.position = "absolute";
				holder.style.width = image.width + "px";
				holder.style.height = image.height + "px";

				// Append the chart container to the map container
				image.chart.chartDiv.appendChild(holder);

				// Create a pie chart
				var chart = AmCharts.makeChart(image.id, image.pie);

				return holder;
			}



			function clickedPie(e) {

				// Toggle showing or hiding barChartDiv and lineGraphDiv
				// var	barChartDiv = document.getElementById("barChartDiv");
				// var	lineGraphDiv = document.getElementById("lineGraphDiv");
				//
				// if (barChartDiv.style.display == "none") {
				// 	barChartDiv.style.display = "inline-block";
				// 	lineGraphDiv.style.display = "none";
				// }
				// else {
				// 	barChartDiv.style.display = "none";
				// 	lineGraphDiv.style.display = "inline-block";
				// }
			}
		</script>

	</body>
</html>
